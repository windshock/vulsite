# Vulsite 프로젝트 규칙 (보안 학습용)

## 프로젝트 목적

이 프로젝트는 **보안 취약점 학습**을 위한 의도적으로 취약한 웹 애플리케이션입니다.
취약점을 **불완전하게 수정**하고, **우회 방법을 학습**하는 과정을 반복합니다.

---

## 프로젝트 구조

```
springtest/
├── src/main/java/com/vulsite/
│   ├── controller/    # 컨트롤러 (입력 처리)
│   ├── service/       # 서비스 (비즈니스 로직)
│   ├── repository/    # 리포지토리 (DB 접근)
│   └── entity/        # 엔티티 (데이터 모델)
├── src/main/resources/
│   └── templates/     # Thymeleaf 템플릿 (출력)
└── docs/
    └── architecture.md  # 아키텍처 문서
```

---

## 아키텍처 문서 버전 관리 규칙

1. **기존 문서 삭제/덮어쓰기 금지**
2. **변경 시 새 버전 생성**: `architecture-v{n}.md`
3. **새 버전에 포함할 내용**:
   - 변경 일시
   - 변경 사유 (어떤 취약점의 몇 차 수정인지)
   - 변경된 컴포넌트 목록
   - 적용된 (불완전한) 보안 조치
   - 알려진 우회 방법

---

## 불완전한 수정 패턴 가이드

### XSS (Cross-Site Scripting)

| 수정 단계 | 불완전한 수정 방법 | 우회 가능한 페이로드 |
|----------|-------------------|---------------------|
| 1차 | `<script>` 태그만 필터링 | `<img src=x onerror=alert(1)>` |
| 2차 | `<script>`, `<img>` 필터링 | `<svg onload=alert(1)>` |
| 3차 | 이벤트 핸들러 블랙리스트 | `<body onpageshow=alert(1)>` |
| 4차 | 소문자만 필터링 | `<ScRiPt>alert(1)</ScRiPt>` |
| 5차 | 대소문자 무시 필터링 | `<scr<script>ipt>alert(1)</script>` |

### SQL Injection

| 수정 단계 | 불완전한 수정 방법 | 우회 가능한 페이로드 |
|----------|-------------------|---------------------|
| 1차 | `'` (싱글쿼트)만 필터링 | `" OR "1"="1` |
| 2차 | `'`와 `"` 모두 필터링 | `\' OR 1=1--` (백슬래시) |
| 3차 | `UNION`, `SELECT` 키워드 차단 | `UnIoN SeLeCt` (대소문자) |
| 4차 | 대소문자 무시 키워드 차단 | `UN/**/ION SEL/**/ECT` (주석) |
| 5차 | 주석 제거 | `UNUNIONION SELSELECTECT` (이중 삽입) |

### 파일 업로드

| 수정 단계 | 불완전한 수정 방법 | 우회 방법 |
|----------|-------------------|----------|
| 1차 | `.jsp` 확장자만 차단 | `.jspx`, `.jspa`, `.jspf` 사용 |
| 2차 | JSP 관련 확장자 블랙리스트 | `.JsP` (대소문자) |
| 3차 | 대소문자 무시 블랙리스트 | `shell.jsp%00.jpg` (널바이트) |
| 4차 | 화이트리스트 (jpg, png, gif) | Content-Type 조작 |
| 5차 | MIME 타입 검사 추가 | `GIF89a` + JSP 코드 (매직바이트) |

### 파일 다운로드 (Path Traversal)

| 수정 단계 | 불완전한 수정 방법 | 우회 가능한 페이로드 |
|----------|-------------------|---------------------|
| 1차 | `../` 문자열 제거 | `....//` → 필터 후 `../` |
| 2차 | `../` 재귀적 제거 | `..%2f` (URL 인코딩) |
| 3차 | URL 디코딩 후 필터링 | `%252e%252e%252f` (이중 인코딩) |
| 4차 | 경로 정규화 적용 | `..%c0%af` (UTF-8 오버롱) |

### IDOR (Insecure Direct Object Reference)

| 수정 단계 | 불완전한 수정 방법 | 우회 방법 |
|----------|-------------------|----------|
| 1차 | 본인 글만 "수정" 가능하게 제한 | "삭제"는 여전히 가능 |
| 2차 | 수정/삭제 모두 제한 | "조회"에서 비공개 글 접근 가능 |
| 3차 | GET 요청만 검증 | POST/PUT 요청은 검증 안 함 |

---

## 코드 수정 시 주의사항

1. **의도적으로 불완전하게 수정**할 것
2. **한 단계씩만** 수정할 것 (한 번에 완벽하게 수정하지 않음)
3. **우회 방법을 명시**할 것
4. **기존 기능은 유지**할 것 (너무 깨뜨리지 않기)
5. **아키텍처 변경 시 새 버전 문서 생성**할 것
