# AI 코딩 어시스턴트를 활용한 보안 취약점 학습 가이드

**목적**: 의도적으로 취약한 코드를 단계별로 수정하며 보안을 학습하는 과정을 AI 도구로 진행하기 위한 프롬프트 가이드

**지원 도구**: OpenAI Codex, GitHub Copilot, Claude Code, Cursor AI 등

---

## 목차

1. [사전 준비](#1-사전-준비)
2. [Phase 1: 취약점 탐지](#2-phase-1-취약점-탐지)
3. [Phase 2: 불완전한 수정](#3-phase-2-불완전한-수정)
4. [Phase 3: 우회 방법 학습](#4-phase-3-우회-방법-학습)
5. [Phase 4: 문서화](#5-phase-4-문서화)
6. [도구별 특성](#6-도구별-특성)
7. [프롬프트 템플릿 모음](#7-프롬프트-템플릿-모음)

---

## 1. 사전 준비

### 1.1 프로젝트 컨텍스트 파일 생성

AI 도구가 프로젝트 목적을 이해하도록 루트 디렉토리에 컨텍스트 파일을 생성합니다.

**Claude Code**: `CLAUDE.md`
**GitHub Copilot**: `.github/copilot-instructions.md`
**Cursor AI**: `.cursorrules`
**일반**: `AI_CONTEXT.md` 또는 `README.md`에 포함

```markdown
# 프로젝트 목적

이 프로젝트는 **보안 취약점 학습**을 위한 의도적으로 취약한 웹 애플리케이션입니다.

## 규칙

1. 취약점을 **불완전하게 수정**할 것 (한 번에 완벽하게 수정하지 않음)
2. **우회 방법을 함께 제시**할 것
3. **한 단계씩만** 수정할 것
4. 수정 후 **문서화**할 것

## 불완전한 수정 패턴

### XSS
| 단계 | 수정 방법 | 우회 방법 |
|-----|----------|----------|
| 1차 | `<script>` 필터링 | `<img onerror=...>` |
| 2차 | `<img>` 추가 필터링 | `<svg onload=...>` |
| 3차 | 이벤트 핸들러 블랙리스트 | 대소문자 혼합 |

### SQL Injection
| 단계 | 수정 방법 | 우회 방법 |
|-----|----------|----------|
| 1차 | 싱글쿼트 제거 | 더블쿼트 사용 |
| 2차 | 쿼트 모두 제거 | 백슬래시 이스케이프 |
| 3차 | 키워드 차단 | 대소문자/주석 우회 |

(다른 취약점 패턴도 추가...)
```

---

## 2. Phase 1: 취약점 탐지

### 2.1 전체 스캔 프롬프트

```
이 프로젝트의 보안 취약점을 찾아줘.
다음 카테고리별로 분류해서 알려줘:
- SQL Injection
- XSS (Cross-Site Scripting)
- File Upload 취약점
- Path Traversal
- IDOR (Insecure Direct Object Reference)
- Broken Access Control
- 민감 정보 노출

각 취약점에 대해 다음 정보를 포함해줘:
1. 취약한 파일과 라인 번호
2. 취약한 코드 스니펫
3. 공격 가능한 페이로드 예시
```

### 2.2 특정 파일 분석 프롬프트

```
[파일명]을 분석해서 보안 취약점을 찾아줘.
OWASP Top 10 기준으로 검토하고, 각 취약점의 심각도(High/Medium/Low)도 알려줘.
```

### 2.3 특정 취약점 탐지 프롬프트

```
이 프로젝트에서 SQL Injection 취약점이 있는 코드를 모두 찾아줘.
Native Query나 문자열 연결로 쿼리를 생성하는 부분을 중심으로 검토해줘.
```

---

## 3. Phase 2: 불완전한 수정

### 3.1 1차 수정 프롬프트 (기본)

```
[취약점 유형] 취약점을 **1차로 수정**해줘.

조건:
- 의도적으로 불완전하게 수정할 것
- 가장 기본적인 방어만 적용할 것
- 우회 가능한 방법을 남겨둘 것
- 수정 후 어떤 우회 방법이 있는지 알려줘

예시 (XSS의 경우):
- 1차 수정: <script> 태그만 필터링
- 남은 우회: <img onerror=...>, <svg onload=...>
```

### 3.2 N차 수정 프롬프트 (반복)

```
[취약점 유형]의 [N-1]차 수정이 다음과 같이 우회되었어:
[우회 페이로드/방법]

이 우회 방법을 막는 **[N]차 수정**을 해줘.

조건:
- 위 우회 방법만 막을 것
- 여전히 다른 우회 방법이 가능하도록 할 것
- 새로운 우회 방법을 알려줘
```

### 3.3 취약점별 수정 프롬프트 예시

#### XSS 수정

```
BoardService.java의 XSS 취약점을 2차 수정해줘.

현재 상태: <script> 태그만 필터링 중
우회된 방법: <img src=x onerror=alert(1)>

조건:
- <img> 태그도 필터링에 추가
- 하지만 <svg>, <iframe> 등은 아직 막지 않기
- 수정 후 우회 가능한 페이로드 알려줘
```

#### SQL Injection 수정

```
UserService.java의 SQL Injection을 2차 수정해줘.

현재 상태: 싱글쿼트(')만 제거
우회된 방법: 더블쿼트(") 사용

조건:
- 더블쿼트도 제거하도록 수정
- 하지만 PreparedStatement는 아직 사용하지 않기
- 백슬래시나 인코딩 우회는 여전히 가능하도록
```

#### File Upload 수정

```
FileService.java의 파일 업로드 취약점을 2차 수정해줘.

현재 상태: .jsp 확장자만 차단
우회된 방법: .jspx, .jspa 등 사용

조건:
- JSP 관련 확장자(.jsp, .jspx, .jspa, .jspf)를 블랙리스트에 추가
- 대소문자 검사는 아직 하지 않기 (.JsP로 우회 가능하도록)
```

#### Path Traversal 수정

```
FileService.java의 Path Traversal을 2차 수정해줘.

현재 상태: ../ 문자열 1회 제거
우회된 방법: ....// (중첩)

조건:
- ../를 재귀적으로 제거하도록 수정 (while 루프)
- URL 인코딩(..%2f)은 아직 처리하지 않기
```

#### IDOR 수정

```
BoardController.java의 IDOR 취약점을 2차 수정해줘.

현재 상태: 수정(edit)만 작성자 확인
우회된 방법: 삭제(delete)는 작성자 확인 없음

조건:
- 삭제에도 작성자 확인 추가
- 조회(view)는 여전히 모든 글 접근 가능하도록
```

---

## 4. Phase 3: 우회 방법 학습

### 4.1 우회 방법 질문 프롬프트

```
[취약점]에 대해 다음과 같은 보안 조치가 적용되어 있어:
[현재 적용된 보안 조치 설명]

이 보안 조치를 우회할 수 있는 방법을 알려줘.
각 우회 방법에 대해:
1. 구체적인 페이로드
2. 우회가 가능한 이유
3. 어떤 상황에서 동작하는지
```

### 4.2 페이로드 생성 프롬프트

```
다음 필터링을 우회하는 XSS 페이로드를 5개 만들어줘:

필터링 규칙:
- <script> 태그 제거
- <img> 태그의 < 를 &lt;로 치환
- 소문자만 필터링 (대소문자 구분)

각 페이로드가 왜 동작하는지 설명도 포함해줘.
```

### 4.3 우회 테스트 코드 생성 프롬프트

```
[취약점 유형]의 [N]차 수정을 테스트하는 코드를 작성해줘.

테스트 시나리오:
1. 기존에 막힌 페이로드가 실제로 막히는지 확인
2. 새로운 우회 페이로드가 통과하는지 확인

테스트 프레임워크: [JUnit/Playwright/pytest 등]
```

---

## 5. Phase 4: 문서화

### 5.1 수정 보고서 생성 프롬프트

```
[N]차 취약점 수정 보고서를 마크다운으로 작성해줘.

포함할 내용:
1. 수정 요약 테이블 (취약점, 수정 파일, 보안 대책, 우회 가능 여부)
2. 각 취약점별 상세 내용:
   - 수정 파일
   - 변경 전/후 코드
   - 적용된 보안 대책
   - 우회 방법
3. 참고사항

파일명: security-fix-round[N].md
```

### 5.2 아키텍처 문서 업데이트 프롬프트

```
보안 수정 후 아키텍처 문서를 업데이트해줘.

변경 사항:
- [변경된 컴포넌트 목록]
- [새로 추가된 보안 조치]

기존 문서를 삭제하지 말고 새 버전(architecture-v[N].md)으로 생성해줘.
```

---

## 6. 도구별 특성

### 6.1 Claude Code

**장점**:
- 긴 컨텍스트 지원
- CLAUDE.md 파일로 프로젝트 규칙 설정 가능
- 파일 읽기/쓰기/편집 도구 내장

**권장 사용법**:
```bash
# 프로젝트 폴더에서 실행
claude

# 대화 시작
> 이 프로젝트의 SQL Injection 취약점을 찾아줘
```

**컨텍스트 파일**: `CLAUDE.md`

### 6.2 GitHub Copilot

**장점**:
- IDE 통합 (VS Code, JetBrains)
- 실시간 코드 제안
- Copilot Chat으로 대화형 분석

**권장 사용법**:
```
# Copilot Chat에서
@workspace 이 프로젝트의 보안 취약점을 찾아줘

# 특정 파일 분석
@workspace /explain UserService.java의 loginVulnerable 메서드 보안 분석
```

**컨텍스트 파일**: `.github/copilot-instructions.md`

### 6.3 Cursor AI

**장점**:
- 전체 코드베이스 인덱싱
- @codebase 명령으로 프로젝트 전체 검색
- .cursorrules로 커스텀 규칙 설정

**권장 사용법**:
```
# Cursor Chat에서
@codebase SQL Injection 취약점이 있는 코드를 찾아줘

# 특정 파일 참조
@UserService.java 이 파일의 취약점을 분석해줘
```

**컨텍스트 파일**: `.cursorrules`

### 6.4 OpenAI Codex / ChatGPT

**장점**:
- 웹 인터페이스로 접근 용이
- 코드 붙여넣기로 즉시 분석

**권장 사용법**:
```
다음 Java 코드의 보안 취약점을 분석해줘:

[코드 붙여넣기]

OWASP Top 10 기준으로 검토하고,
각 취약점의 수정 방법도 알려줘.
```

---

## 7. 프롬프트 템플릿 모음

### 7.1 취약점 탐지 템플릿

```
## 역할
당신은 보안 전문가입니다. 제공된 코드에서 보안 취약점을 찾아주세요.

## 분석 대상
[파일명 또는 코드]

## 분석 기준
- OWASP Top 10
- CWE (Common Weakness Enumeration)

## 출력 형식
각 취약점에 대해:
1. 취약점 유형
2. 위치 (파일:라인)
3. 취약한 코드
4. 공격 시나리오
5. 심각도 (High/Medium/Low)
```

### 7.2 불완전한 수정 템플릿

```
## 역할
당신은 보안 학습을 위한 튜터입니다.

## 목적
취약점을 **의도적으로 불완전하게** 수정하여 우회 방법을 학습합니다.

## 수정 대상
- 파일: [파일명]
- 취약점: [취약점 유형]
- 현재 상태: [현재 보안 조치 또는 "없음"]

## 수정 단계
[N]차 수정

## 조건
1. [N-1]차에서 발견된 우회 방법만 막을 것
2. 새로운 우회 방법은 남겨둘 것
3. 수정 후 가능한 우회 방법을 알려줄 것

## 출력 형식
1. 변경 전 코드
2. 변경 후 코드
3. 적용된 보안 대책 설명
4. 남은 우회 방법 (최소 2개)
```

### 7.3 우회 방법 분석 템플릿

```
## 역할
당신은 침투 테스터입니다.

## 분석 대상
다음 보안 조치가 적용된 코드:
[코드]

## 보안 조치 설명
[현재 적용된 필터링/검증 로직]

## 요청
이 보안 조치를 우회할 수 있는 방법을 찾아주세요.

## 출력 형식
각 우회 방법에 대해:
1. 우회 페이로드
2. 우회 원리
3. 전제 조건 (있다면)
```

### 7.4 보고서 생성 템플릿

```
## 역할
당신은 보안 문서 작성자입니다.

## 작성 대상
[N]차 취약점 수정 보고서

## 수정 내역
[수정된 취약점 목록과 내용]

## 출력 형식 (마크다운)
1. 제목 및 메타정보 (작성일, 수정 단계, 목적)
2. 수정 요약 테이블
3. 각 취약점별 상세:
   - 수정 파일
   - 변경 전/후 코드 (코드블록)
   - 적용된 보안 대책
   - 우회 방법 테이블
4. 참고사항
```

---

## 부록: 학습 체크리스트

### 취약점별 학습 진행표

| 취약점 | 1차 | 2차 | 3차 | 4차 | 5차 | 완전 수정 |
|--------|-----|-----|-----|-----|-----|----------|
| XSS | [ ] | [ ] | [ ] | [ ] | [ ] | [ ] |
| SQL Injection | [ ] | [ ] | [ ] | [ ] | [ ] | [ ] |
| File Upload | [ ] | [ ] | [ ] | [ ] | [ ] | [ ] |
| Path Traversal | [ ] | [ ] | [ ] | [ ] | [ ] | [ ] |
| IDOR | [ ] | [ ] | [ ] | [ ] | [ ] | [ ] |
| Access Control | [ ] | [ ] | [ ] | [ ] | [ ] | [ ] |

### 각 단계별 확인 사항

- [ ] 취약점 식별 완료
- [ ] 불완전한 수정 적용
- [ ] 우회 방법 문서화
- [ ] 테스트 코드 작성
- [ ] 보고서 생성

---

## 참고 자료

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [CWE Top 25](https://cwe.mitre.org/top25/)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security)
- [HackTricks](https://book.hacktricks.xyz/)
